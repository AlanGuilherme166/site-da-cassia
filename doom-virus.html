<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <title>Doom: Tiro em Vírus</title>
    <!-- Three.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <style>
        #round-overlay {
            position: fixed;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.85);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            font-size: 2.2rem;
        }
            #buff-overlay {
                position: fixed;
                left: 0; top: 0; width: 100vw; height: 100vh;
                background: rgba(0,0,0,0.92);
                color: #fff;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            }
            .buff-title {
                font-family: 'Creepster', cursive;
                color: #ffeb3b;
                font-size: 2.2rem;
                margin-bottom: 1.2rem;
                text-shadow: 2px 2px 8px #000, 0 0 16px #ffeb3b;
            }
            .buff-cards {
                display: flex;
                gap: 2rem;
            }
            .buff-card {
                background: #232323;
                border-radius: 18px;
                box-shadow: 0 0 16px #000;
                width: 140px;
                height: 180px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                border: 4px solid transparent;
                transition: border 0.2s, transform 0.2s;
                font-family: 'Roboto', sans-serif;
            }
            .buff-card:hover {
                border: 4px solid #ffeb3b;
                transform: scale(1.07);
            }
            .buff-emoji {
                font-size: 3.5rem;
                margin-bottom: 1rem;
        document.getElementById('round-overlay').style.display = 'none';
        spawnWave();
    }
    document.getElementById('start-round-btn').onclick = hideRoundOverlay;

    // --- Sistema de tiro (seringas) ---
    let bullets = [];
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') shoot();
    });
    // --- Sistema de tiro (seringas) ---
    let bullets = [];
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') shoot();
    });

    let roundReady = false;
    function spawnWave() {
        // Limpa inimigos antigos
        for (let i = enemies.length - 1; i >= 0; i--) {
            scene.remove(enemies[i]);
            enemies.splice(i, 1);
        }
        // Aumenta dificuldade a cada wave
        enemiesToSpawn = 3 + Math.floor(currentWave * 1.2);
        for (let i = 0; i < enemiesToSpawn; i++) {
            let angle = Math.random() * Math.PI * 2;
            let radius = 13;
            let x = Math.cos(angle) * radius;
            let z = Math.sin(angle) * radius;
            let enemyGeo = new THREE.SphereGeometry(1, 32, 32);
            let enemyMat = new THREE.MeshPhongMaterial({ color: 0xc62828 });
            let enemy = new THREE.Mesh(enemyGeo, enemyMat);
            enemy.position.set(x, 1, z);
            scene.add(enemy);
            enemies.push(enemy);
        }
        enemiesAlive = enemiesToSpawn;
        currentWave++;
        roundInProgress = false;
        roundReady = false;
        setTimeout(() => { roundReady = true; roundInProgress = true; }, 400); // só começa após sprites aparecerem
    }
    showRoundOverlay();
    // ...existing code...
    // --- Three.js setup ---
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('game-area').appendChild(renderer.domElement);

    // Arena (chão)
    let floorGeometry = new THREE.PlaneGeometry(30, 30);
    let floorMaterial = new THREE.MeshPhongMaterial({ color: 0x222222 });
    let floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // Luz
    let light = new THREE.PointLight(0xffffff, 1, 100);
    light.position.set(0, 20, 10);
    scene.add(light);

    // Player (bactéria)
    let bacteriaGeometry = new THREE.SphereGeometry(1, 32, 32);
    let bacteriaMaterial = new THREE.MeshPhongMaterial({ color: 0x00c853 });
    let bacteria = new THREE.Mesh(bacteriaGeometry, bacteriaMaterial);
    bacteria.position.set(0, 1, 10);
    scene.add(bacteria);

    // Pessoa defendida
    let personGeometry = new THREE.SphereGeometry(1.2, 32, 32);
    let personMaterial = new THREE.MeshPhongMaterial({ color: 0xffe082 });
    let person = new THREE.Mesh(personGeometry, personMaterial);
    person.position.set(0, 1.2, -10);
    scene.add(person);

    // Inimigos (vírus vermelhos)
    // Removido bloco duplicado. Usar apenas a versão moderna de spawnWave e variáveis já declaradas acima.

    // Camera
    camera.position.set(0, 5, 18);
    camera.lookAt(bacteria.position);

    // Movimentação básica (WASD)
    let move = { left: false, right: false, up: false, down: false };
    document.addEventListener('keydown', (e) => {
        if (e.code === 'KeyA') move.left = true;
        if (e.code === 'KeyD') move.right = true;
        if (e.code === 'KeyW') move.up = true;
        if (e.code === 'KeyS') move.down = true;
    });
    document.addEventListener('keyup', (e) => {
        if (e.code === 'KeyA') move.left = false;
        if (e.code === 'KeyD') move.right = false;
        if (e.code === 'KeyW') move.up = false;
        if (e.code === 'KeyS') move.down = false;
    });

    function animate() {
        // Atualiza balas (seringas)
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.mesh.position.addScaledVector(b.dir, 0.7);
            // Remove se sair da arena
            if (Math.abs(b.mesh.position.x) > 16 || Math.abs(b.mesh.position.z) > 16) {
                scene.remove(b.mesh);
                bullets.splice(i, 1);
                continue;
            }
            // Colisão com inimigos
            for (let j = enemies.length - 1; j >= 0; j--) {
                let enemy = enemies[j];
                if (b.mesh.position.distanceTo(enemy.position) < 1.2) {
                    scene.remove(enemy);
                    enemies.splice(j, 1);
                    scene.remove(b.mesh);
                    bullets.splice(i, 1);
                    break;
                }
            }
        }
        // Movimentação do player
        let speed = 0.2;
        if (move.left) bacteria.position.x -= speed;
        if (move.right) bacteria.position.x += speed;
        if (move.up) bacteria.position.z -= speed;
        if (move.down) bacteria.position.z += speed;
        // Limites da arena
        bacteria.position.x = Math.max(-14, Math.min(14, bacteria.position.x));
        bacteria.position.z = Math.max(-14, Math.min(14, bacteria.position.z));
        camera.lookAt(bacteria.position);

        // Movimento dos inimigos em direção à pessoa só se roundReady
        if (roundReady) {
            let enemySpeed = 0.04 + wave * 0.01;
            for (let i = enemies.length - 1; i >= 0; i--) {
                let enemy = enemies[i];
                let dir = new THREE.Vector3();
                dir.subVectors(person.position, enemy.position).normalize();
                enemy.position.x += dir.x * enemySpeed;
                enemy.position.z += dir.z * enemySpeed;
                // Checa se chegou na pessoa
                let dist = enemy.position.distanceTo(person.position);
                if (dist < 2) {
                    // Game over (pode melhorar depois)
                    alert('Game Over! O vírus alcançou a pessoa!');
                    window.location.reload();
                    return;
                }
            }
        }

        renderer.render(scene, camera);
        requestAnimationFrame(animate);
    }
    animate();
    </script>
</body>
</html>
